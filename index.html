<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WeatherPro - Live Weather App</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@200;300;400;500;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-bg: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --text-color: white;
            --card-bg: rgba(255, 255, 255, 0.15);
            --card-border: 1px solid rgba(255, 255, 255, 0.2);
            --shadow: 0 8px 32px rgba(0,0,0,0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--primary-bg);
            color: var(--text-color);
            min-height: 100vh;
            overflow-x: hidden;
            transition: background 0.8s ease;
        }
        
        /* Weather-specific background themes */
        body.sunny { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); }
        body.cloudy { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        body.rainy { background: linear-gradient(135deg, #4b6cb7 0%, #182848 100%); }
        body.snowy { background: linear-gradient(135deg, #e6ddd4 0%, #d5d4d0 100%); color: #333; }
        body.clear-night { background: linear-gradient(135deg, #0f2027 0%, #203a43 50%, #2c5364 100%); }
        body.misty { background: linear-gradient(135deg, #bdc3c7 0%, #2c3e50 100%); }

        .weather-particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
        }

        .particle {
            position: absolute;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            animation: float 6s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); opacity: 0; }
            50% { transform: translateY(-100px) rotate(180deg); opacity: 1; }
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
            z-index: 2;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 3rem;
            font-weight: 300;
            margin-bottom: 10px;
            text-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }

        .search-container {
            max-width: 500px;
            margin: 0 auto 40px;
            position: relative;
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .search-box {
            flex-grow: 1;
            padding: 15px 20px;
            border: none;
            border-radius: 50px;
            font-size: 1.1rem;
            background: var(--card-bg);
            backdrop-filter: blur(10px);
            color: var(--text-color);
            outline: none;
            transition: all 0.3s ease;
            box-shadow: var(--shadow);
        }

        .search-box::placeholder { color: rgba(255, 255, 255, 0.7); }
        .search-box:focus { background: rgba(255, 255, 255, 0.25); transform: scale(1.02); }

        .icon-btn {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            flex-shrink: 0;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.3rem;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        .icon-btn:hover { transform: scale(1.1); box-shadow: 0 5px 15px rgba(238, 90, 36, 0.4); }
        .location-btn { background: linear-gradient(45deg, #4ecdc4, #44a08d); }
        .location-btn:hover { box-shadow: 0 5px 15px rgba(68, 160, 141, 0.4); }

        .weather-main {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .current-weather, .weather-details, .forecast-container {
            background: var(--card-bg);
            backdrop-filter: blur(10px);
            border-radius: 25px;
            padding: 30px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            border: var(--card-border);
            transition: all 0.3s ease;
        }
        .current-weather:hover, .weather-details:hover, .forecast-item:hover { transform: translateY(-5px); box-shadow: 0 25px 50px rgba(0,0,0,0.15); }
        .current-weather { text-align: center; }

        .weather-icon {
            font-size: 4.5rem;
            margin-bottom: 20px;
            animation: bounce 2s infinite;
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-10px); }
            60% { transform: translateY(-5px); }
        }

        .temperature { font-size: 4rem; font-weight: 200; margin-bottom: 10px; }
        .city-name { font-size: 1.8rem; margin-bottom: 10px; font-weight: 400; }
        .weather-desc { font-size: 1.2rem; opacity: 0.9; text-transform: capitalize; }

        .detail-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        .detail-item:last-child { border-bottom: none; }
        .detail-label { font-size: 1.1rem; opacity: 0.9; }
        .detail-value { font-size: 1.2rem; font-weight: 500; }

        .forecast-title {
            font-size: 1.8rem;
            font-weight: 300;
            margin-bottom: 25px;
            text-align: center;
        }

        .forecast-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 20px;
        }

        .forecast-item {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px 15px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .forecast-day { font-size: 1.1rem; font-weight: 500; margin-bottom: 10px; }
        .forecast-icon { font-size: 2.5rem; margin: 10px 0; }
        .forecast-temps { display: flex; justify-content: space-evenly; margin-top: 10px; font-size: 1rem; }
        .temp-high { font-weight: 600; }
        .temp-low { opacity: 0.7; }

        .unit-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--card-bg);
            border: none;
            border-radius: 20px;
            color: var(--text-color);
            padding: 10px 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1rem;
            z-index: 10;
        }
        .unit-toggle:hover { background: rgba(255, 255, 255, 0.3); transform: scale(1.05); }

        .loading, .error { text-align: center; margin: 50px 0; display: none; }
        .loading.show, .error.show { display: block; }

        .spinner {
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top: 3px solid var(--text-color);
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        .error {
            background: rgba(255, 107, 107, 0.2);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(255, 107, 107, 0.3);
        }

        @media (max-width: 768px) {
            .header h1 { font-size: 2.5rem; }
            .weather-main { grid-template-columns: 1fr; gap: 20px; }
            .current-weather, .weather-details, .forecast-container { padding: 25px; }
            .forecast-grid { grid-template-columns: repeat(auto-fit, minmax(130px, 1fr)); }
            .search-container { flex-direction: column; }
            .search-box { width: 100%; margin-bottom: 10px;}
            .icon-btn-group { display: flex; gap: 10px; }
        }
    </style>
</head>
<body id="body">
    <div class="weather-particles" id="particles"></div>
    
    <button class="unit-toggle" id="unitToggle">¬∞F</button>
    
    <div class="container">
        <header class="header">
            <h1>WeatherPro</h1>
        </header>

        <div class="search-container">
            <input type="text" class="search-box" id="searchBox" placeholder="Enter city name..." />
            <div class="icon-btn-group">
                 <button class="icon-btn location-btn" id="locationBtn" title="Use current location">üìç</button>
                 <button class="icon-btn search-btn" id="searchBtn">üîç</button>
            </div>
        </div>

        <div class="loading" id="loading">
            <div class="spinner"></div>
            <p>Fetching weather data...</p>
        </div>

        <div class="error" id="error">
            <p>Unable to fetch weather data. Please try again.</p>
        </div>

        <div id="weather-content" style="display: none;">
            <div class="weather-main">
                <div class="current-weather">
                    <div class="weather-icon" id="mainIcon">‚òÄÔ∏è</div>
                    <div class="temperature" id="temperature">25¬∞C</div>
                    <div class="city-name" id="cityName">New York</div>
                    <div class="weather-desc" id="weatherDesc">Clear Sky</div>
                </div>

                <div class="weather-details">
                    <div class="detail-item">
                        <span class="detail-label">Feels like</span>
                        <span class="detail-value" id="feelsLike">28¬∞C</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Humidity</span>
                        <span class="detail-value" id="humidity">65%</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Wind Speed</span>
                        <span class="detail-value" id="windSpeed">12 km/h</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Pressure</span>
                        <span class="detail-value" id="pressure">1013 hPa</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Sunrise</span>
                        <span class="detail-value" id="sunrise">6:00 AM</span>
                    </div>
                     <div class="detail-item">
                        <span class="detail-label">Sunset</span>
                        <span class="detail-value" id="sunset">7:00 PM</span>
                    </div>
                </div>
            </div>

            <div class="forecast-container">
                <h2 class="forecast-title">5-Day Forecast</h2>
                <div class="forecast-grid" id="forecastGrid">
                    <!-- Forecast items will be dynamically inserted here -->
                </div>
            </div>
        </div>
    </div>

    <script>
        class WeatherApp {
            constructor() {
                // IMPORTANT: Replace 'YOUR_API_KEY' with your actual OpenWeatherMap API key.
                // See the guide for instructions on how to get your free key.
                this.apiKey = '185b0444cfa88d29ec533fc3ad5cb099'; 
                this.isCelsius = true;
                this.currentWeather = null;
                this.forecast = null;
                
                this.elements = {
                    searchBox: document.getElementById('searchBox'),
                    searchBtn: document.getElementById('searchBtn'),
                    locationBtn: document.getElementById('locationBtn'),
                    unitToggle: document.getElementById('unitToggle'),
                    loading: document.getElementById('loading'),
                    error: document.getElementById('error'),
                    errorMsg: document.querySelector('#error p'),
                    weatherContent: document.getElementById('weather-content'),
                    body: document.getElementById('body'),
                    mainIcon: document.getElementById('mainIcon'),
                    temperature: document.getElementById('temperature'),
                    cityName: document.getElementById('cityName'),
                    weatherDesc: document.getElementById('weatherDesc'),
                    feelsLike: document.getElementById('feelsLike'),
                    humidity: document.getElementById('humidity'),
                    windSpeed: document.getElementById('windSpeed'),
                    pressure: document.getElementById('pressure'),
                    sunrise: document.getElementById('sunrise'),
                    sunset: document.getElementById('sunset'),
                    forecastGrid: document.getElementById('forecastGrid'),
                };
                
                this.attachEventListeners();
                this.createParticles();
                this.loadDefaultWeather();
            }

            attachEventListeners() {
                this.elements.searchBtn.addEventListener('click', () => this.searchWeather());
                this.elements.searchBox.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') this.searchWeather();
                });
                this.elements.locationBtn.addEventListener('click', () => this.getCurrentLocation());
                this.elements.unitToggle.addEventListener('click', () => this.toggleUnit());
            }

            createParticles() {
                const particlesContainer = document.getElementById('particles');
                for (let i = 0; i < 20; i++) {
                    const particle = document.createElement('div');
                    particle.className = 'particle';
                    particle.style.left = `${Math.random() * 100}%`;
                    const size = Math.random() * 4 + 2;
                    particle.style.width = `${size}px`;
                    particle.style.height = `${size}px`;
                    particle.style.animationDelay = `${Math.random() * 6}s`;
                    particle.style.animationDuration = `${Math.random() * 4 + 4}s`;
                    particlesContainer.appendChild(particle);
                }
            }

            // --- UI State Management ---
            showLoading() {
                this.elements.loading.classList.add('show');
                this.elements.error.classList.remove('show');
                this.elements.weatherContent.style.display = 'none';
            }

            hideLoading() {
                this.elements.loading.classList.remove('show');
            }

            showError(message) {
                this.elements.errorMsg.textContent = message;
                this.elements.error.classList.add('show');
                this.hideLoading();
            }

            showWeather() {
                this.elements.weatherContent.style.display = 'block';
                this.elements.error.classList.remove('show');
                this.hideLoading();
            }
            
            // --- API & Data Handling ---
            async fetchWeatherData(url) {
                try {
                    const response = await fetch(url);
                    if (!response.ok) {
                        const errorData = await response.json();
                        throw new Error(errorData.message || `HTTP error! status: ${response.status}`);
                    }
                    return await response.json();
                } catch (error) {
                    console.error('Fetch error:', error);
                    this.showError(`Error: ${error.message}. Please check the city name and your API key.`);
                    return null;
                }
            }

            async loadDefaultWeather() {
                await this.getWeatherByCity('London');
            }

            async searchWeather() {
                const city = this.elements.searchBox.value.trim();
                if (city) {
                    await this.getWeatherByCity(city);
                    this.elements.searchBox.value = '';
                }
            }

            async getCurrentLocation() {
                if (!navigator.geolocation) {
                    this.showError('Geolocation is not supported by this browser.');
                    return;
                }
                this.showLoading();
                navigator.geolocation.getCurrentPosition(
                    pos => this.getWeatherByCoords(pos.coords.latitude, pos.coords.longitude),
                    () => this.showError('Unable to retrieve your location. Please allow location access or search manually.')
                );
            }

            async getWeatherByCity(city) {
                this.showLoading();
                const weatherUrl = `https://api.openweathermap.org/data/2.5/weather?q=${city}&appid=${this.apiKey}&units=metric`;
                const forecastUrl = `https://api.openweathermap.org/data/2.5/forecast?q=${city}&appid=${this.apiKey}&units=metric`;
                
                const weatherData = await this.fetchWeatherData(weatherUrl);
                if (weatherData) {
                    this.currentWeather = weatherData;
                    const forecastData = await this.fetchWeatherData(forecastUrl);
                    if (forecastData) {
                        this.forecast = forecastData;
                        this.updateUI();
                    }
                }
            }

            async getWeatherByCoords(lat, lon) {
                this.showLoading();
                const weatherUrl = `https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&appid=${this.apiKey}&units=metric`;
                const forecastUrl = `https://api.openweathermap.org/data/2.5/forecast?lat=${lat}&lon=${lon}&appid=${this.apiKey}&units=metric`;

                const weatherData = await this.fetchWeatherData(weatherUrl);
                 if (weatherData) {
                    this.currentWeather = weatherData;
                    const forecastData = await this.fetchWeatherData(forecastUrl);
                    if (forecastData) {
                        this.forecast = forecastData;
                        this.updateUI();
                    }
                }
            }
            
            // --- UI Updates ---
            updateUI() {
                if (!this.currentWeather || !this.forecast) return;
                this.displayCurrentWeather();
                this.displayForecast();
                this.updateBackground();
                this.showWeather();
            }

            displayCurrentWeather() {
                const { name, main, weather, wind, sys } = this.currentWeather;
                const temp = this.isCelsius ? main.temp : this.celsiusToFahrenheit(main.temp);
                const feelsLike = this.isCelsius ? main.feels_like : this.celsiusToFahrenheit(main.feels_like);
                const windSpeed = this.isCelsius ? wind.speed * 3.6 : wind.speed * 2.237;

                this.elements.mainIcon.textContent = this.getWeatherIcon(weather[0].id, sys.sunrise, sys.sunset);
                this.elements.temperature.textContent = `${Math.round(temp)}¬∞${this.isCelsius ? 'C' : 'F'}`;
                this.elements.cityName.textContent = name;
                this.elements.weatherDesc.textContent = weather[0].description;
                this.elements.feelsLike.textContent = `${Math.round(feelsLike)}¬∞${this.isCelsius ? 'C' : 'F'}`;
                this.elements.humidity.textContent = `${main.humidity}%`;
                this.elements.windSpeed.textContent = `${windSpeed.toFixed(1)} ${this.isCelsius ? 'km/h' : 'mph'}`;
                this.elements.pressure.textContent = `${main.pressure} hPa`;
                this.elements.sunrise.textContent = this.formatTime(sys.sunrise, this.currentWeather.timezone);
                this.elements.sunset.textContent = this.formatTime(sys.sunset, this.currentWeather.timezone);
            }

            displayForecast() {
                const dailyData = this.processForecastData();
                this.elements.forecastGrid.innerHTML = '';
                
                dailyData.forEach(day => {
                    const high = this.isCelsius ? day.temp_max : this.celsiusToFahrenheit(day.temp_max);
                    const low = this.isCelsius ? day.temp_min : this.celsiusToFahrenheit(day.temp_min);

                    const forecastItem = document.createElement('div');
                    forecastItem.className = 'forecast-item';
                    forecastItem.innerHTML = `
                        <div class="forecast-day">${day.day}</div>
                        <div class="forecast-icon">${this.getWeatherIcon(day.weather.id)}</div>
                        <div class="forecast-temps">
                            <span class="temp-high">${Math.round(high)}¬∞</span>
                            <span class="temp-low">${Math.round(low)}¬∞</span>
                        </div>
                    `;
                    this.elements.forecastGrid.appendChild(forecastItem);
                });
            }
            
            processForecastData() {
                const daily = {};
                this.forecast.list.forEach(item => {
                    const date = new Date(item.dt * 1000).toLocaleDateString([], { weekday: 'short' });
                    if (!daily[date]) {
                        daily[date] = { temps: [], weathers: [] };
                    }
                    daily[date].temps.push(item.main.temp);
                    daily[date].weathers.push(item.weather[0]);
                });
                
                // Exclude today's forecast
                const today = new Date().toLocaleDateString([], { weekday: 'short' });
                delete daily[today];

                return Object.entries(daily).map(([day, data]) => {
                    const mostCommonWeather = data.weathers.sort((a,b) =>
                        data.weathers.filter(v => v.id === a.id).length -
                        data.weathers.filter(v => v.id === b.id).length
                    ).pop();

                    return {
                        day,
                        temp_max: Math.max(...data.temps),
                        temp_min: Math.min(...data.temps),
                        weather: mostCommonWeather,
                    };
                }).slice(0, 5); // Ensure only 5 days
            }

            updateBackground() {
                const id = this.currentWeather.weather[0].id;
                const { sunrise, sunset } = this.currentWeather.sys;
                const isNight = Date.now() / 1000 < sunrise || Date.now() / 1000 > sunset;
                this.elements.body.className = '';

                if (id >= 200 && id < 300) this.elements.body.classList.add('rainy');
                else if (id >= 300 && id < 600) this.elements.body.classList.add('rainy');
                else if (id >= 600 && id < 700) this.elements.body.classList.add('snowy');
                else if (id >= 700 && id < 800) this.elements.body.classList.add('misty');
                else if (id === 800) this.elements.body.classList.add(isNight ? 'clear-night' : 'sunny');
                else if (id > 800) this.elements.body.classList.add('cloudy');
            }
            
            // --- Utility Functions ---
            toggleUnit() {
                this.isCelsius = !this.isCelsius;
                this.elements.unitToggle.textContent = this.isCelsius ? '¬∞F' : '¬∞C';
                if(this.currentWeather && this.forecast) {
                   this.displayCurrentWeather();
                   this.displayForecast();
                }
            }

            celsiusToFahrenheit(c) { return c * 9/5 + 32; }

            getWeatherIcon(id, sunrise, sunset) {
                const isNight = Date.now() / 1000 < sunrise || Date.now() / 1000 > sunset;
                if (id >= 200 && id < 300) return '‚õàÔ∏è'; // Thunderstorm
                if (id >= 300 && id < 400) return 'üíß'; // Drizzle
                if (id >= 500 && id < 600) return 'üåßÔ∏è'; // Rain
                if (id >= 600 && id < 700) return '‚ùÑÔ∏è'; // Snow
                if (id >= 700 && id < 800) return 'üå´Ô∏è'; // Atmosphere (mist, smoke, etc.)
                if (id === 800) return isNight ? 'üåô' : '‚òÄÔ∏è'; // Clear
                if (id === 801) return isNight ? '‚òÅÔ∏è' : 'üå§Ô∏è'; // Few clouds
                if (id === 802) return isNight ? '‚òÅÔ∏è' : '‚õÖ'; // Scattered clouds
                if (id > 802) return '‚òÅÔ∏è'; // Broken/overcast clouds
                return '‚ùì';
            }
            
            formatTime(timestamp, timezoneOffset) {
                const date = new Date((timestamp + timezoneOffset) * 1000);
                return date.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit', timeZone: 'UTC' });
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            new WeatherApp();
        });
    </script>
</body>
</html>
